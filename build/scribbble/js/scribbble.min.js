/*! scribbble 2014-11-24 */
!function(a,b){var c="https://api.dribbble.com/v1",d=function(){this._currentUser=null;var b=function(b){b.url=b.url+"?access_token="+this.token,b.type="GET";var c=b.success||function(){};return b.success=function(){c.apply(this,arguments)},a.ajax(b)};this.setToken=function(a){this.token=a},this.getShot=function(a){return b.call(this,{url:c+"/shots/"+a})},this.getCurrentUser=function(){var a=this;return b.call(this,{url:c+"/user",success:function(b){a._currentUser=b}})},this.getCurrentUserLikes=function(){if(this._currentUser)return b.call(this,{url:this._currentUser.likes_url});var c=a.Deferred(),d=this;return a.when(this.getCurrentUser()).then(function(){a.when(b.call(d,{url:d._currentUser.likes_url})).then(function(a){c.resolve(a)})}),c.promise()},this.doesCurrentUserLikeShot=function(d){var e=a.Deferred();return b.call(this,{url:c+"/shots/"+d+"/like",success:function(){e.resolve(!0)},error:function(a){404===a.status&&e.resolve(!1)}}),e.promise()}};b.scribbble=d,a(document).on("ready",function(){var b=new d;b.setToken(document.getElementById("scribbble-token").value),a(".scribbble-shot").each(function(c,d){var e=a(d),f=e.data("shotid");a.when(b.getShot(f)).then(function(c){a.when(b.doesCurrentUserLikeShot(f)).then(function(b){var d=b?"Unlike":"Like";e.addClass(b?"likes":"").append(a("<a href='"+c.html_url+"' target='_blank' class='shot-link'>"+d+"</a>")).append(a("<span class='shot-likes'>"+c.likes_count+"</span>"))},function(){console.log("err like shot")})},function(){console.log("err get shot"),e.remove()})})})}(jQuery,window);